<div class="profile-wrapper">
  <div class="profile-container">
    <h3>Perfil</h3>

    @if (isLoading) {
      <div class="alert alert-info">Cargando perfil...</div>
    }

    <form [formGroup]="formulario" (ngSubmit)="saveProfile()">
		<div class="form-group mb-3">
			<label for="inputUsername">Username</label>
			<input
				type="text"
				class="form-control"
				id="inputUsername"
				formControlName="username"
				[ngClass]="{ 'is-invalid': usernameNotValid }"
			>
			@if (usernameNotValid) {
				<div class="invalid-feedback">Minimo 3 caracteres</div>
			}
		</div>

		<div class="form-group mb-3">
			<label for="inputFullName">Nombre completo</label>
			<input
				type="text"
				class="form-control"
				id="inputFullName"
				formControlName="full_name"
			>
		</div>

		<div class="form-group mb-3">
			<label class="form-label">Avatar</label>
			<div class="avatar-grid">
				@for (avatar of availableAvatars; track avatar) {
					<button
						type="button"
						class="avatar-option"
						[ngClass]="{ 'selected': isAvatarSelected(avatar) }"
						(click)="selectAvatar(avatar)"
					>
						<img [src]="avatar" alt="Avatar disponible" class="avatar-thumb">
					</button>
				}
			</div>

			@if (formulario.get('avatar_url')?.value) {
				<div class="mt-3">
					<p class="mb-2">Avatar seleccionado:</p>
					<img [src]="formulario.get('avatar_url')?.value" alt="Avatar seleccionado" class="avatar-selected">
				</div>
			}
		</div>

		<div class="form-group mb-3">
			<label for="inputWebsite">Website</label>
			<input
				type="text"
				class="form-control"
				id="inputWebsite"
				formControlName="website"
			>
		</div>

		@if (errorMessage) {
			<div class="alert alert-danger">{{ errorMessage }}</div>
		}

		@if (successMessage) {
			<div class="alert alert-success">{{ successMessage }}</div>
		}

		<button type="submit" class="btn btn-primary" [disabled]="formulario.invalid || isSubmitting">
			{{ isSubmitting ? 'Guardando...' : 'Guardar perfil' }}
		</button>
	</form>
  </div>
</div>
