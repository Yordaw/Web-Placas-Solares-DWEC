<!--Este formulario se hace con Reactive-Forms como se indica en las especificaciones del github:
*Formulari reactiu per al registre, login i perfil d'usuari*
-->
<div class="profile-wrapper">
  <div class="profile-container">
    <div class="d-flex align-items-center gap-2 mb-3">
      <h3 class="mb-0">Perfil</h3>
      @if (rolUsuario()) {
        <span class="badge" [ngClass]="{'bg-success': rolUsuario() === 'admin', 'bg-primary': rolUsuario() !== 'admin'}">
          {{ rolUsuario() === 'admin' ? 'Administrador' : 'Cliente' }}
        </span>
      }
    </div>

    @if (cargando()) {
      <div class="alert alert-info">Cargando perfil...</div>
    } @else {
    <form [formGroup]="formulario" (ngSubmit)="guardarPerfil()">
		<div class="form-group mb-3">
			<label for="inputUsername">Username</label>
			<input
				type="text"
				class="form-control"
				id="inputUsername"
				formControlName="username"
				[ngClass]="{ 'is-invalid': usernameNoValido }"
			>
			@if (usernameNoValido) {
				<div class="invalid-feedback">Minimo 3 caracteres</div>
			}
		</div>

		<div class="form-group mb-3">
			<label for="inputFullName">Nombre completo</label>
			<input
				type="text"
				class="form-control"
				id="inputFullName"
				formControlName="full_name"
			>
		</div>

		<div class="form-group mb-3">
			<label class="form-label">Avatar</label>
			<div class="avatar-grid">
				@for (avatar of avatarsDisponibles; track avatar) {
					<button
						type="button"
						class="avatar-option"
						[ngClass]="{ 'selected': avatarSeleccionado(avatar) }"
						(click)="seleccionarAvatar(avatar)"
					>
						<img [src]="avatar" alt="Avatar disponible" class="avatar-thumb">
					</button>
				}
			</div>

			@if (formulario.get('avatar_url')?.value) {
				<div class="mt-3">
					<p class="mb-2">Avatar seleccionado:</p>
					<img [src]="formulario.get('avatar_url')?.value" alt="Avatar seleccionado" class="avatar-selected">
				</div>
			}
		</div>

		<div class="form-group mb-3">
			<label for="inputWebsite">Web</label>
			<input
				type="text"
				class="form-control"
				id="inputWebsite"
				formControlName="website"
			>
		</div>

		@if (mensajeError()) {
			<div class="alert alert-danger">{{ mensajeError() }}</div>
		}

		@if (mensajeExito()) {
			<div class="alert alert-success">{{ mensajeExito() }}</div>
		}

		<button type="submit" class="btn btn-primary" [disabled]="formulario.invalid || enviando()">
			{{ enviando() ? 'Guardando...' : 'Guardar perfil' }}
		</button>
	</form>
    }
  </div>
</div>
